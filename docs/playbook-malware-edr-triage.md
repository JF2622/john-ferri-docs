# Playbook: Malware / EDR Alert Triage (Tier 1)

## Purpose
Help Tier 1 analysts rapidly validate, triage, and document EDR malware alerts, identify likely false positives, and determine when to escalate for containment and deeper investigation.

## When to Use
- EDR alert: malware detected / quarantine failed / suspicious process behavior
- SIEM alert sourced from EDR telemetry (malicious hash, command-and-control, persistence)
- User report: “Antivirus pop-up,” “device behaving strangely,” “files encrypted” (possible ransomware)

## Required Inputs
- Hostname / device ID
- Username (logged-in or last interactive user)
- Alert name/type and severity
- Timestamp range (UTC and local)
- File path and file hash (SHA256 if available)
- Process name + command line + parent process
- Detection category (malware, PUA, exploit, suspicious behavior)
- Network indicators (remote IP/domain) if present

## Data Sources to Check
- EDR alert details (detection verdict, evidence tree, action taken)
- EDR process tree / timeline (parent/child processes, command line)
- File reputation / hash intelligence (internal or reputable source)
- Host telemetry (new services, scheduled tasks, autoruns) if available
- Network telemetry (DNS, proxy, firewall logs) if available
- Change tickets (recent software installs, admin activity, patching windows)

## Triage Steps (Tier 1)
1. Confirm scope: affected host, user, time, and alert severity
2. Confirm EDR action: Was the file blocked/quarantined/removed, or did remediation fail?
3. Collect core indicators:
    - file path
    - hash
    - process + parent process
    - command line
    - network indicators (if any)
4. Review the process tree for suspicious patterns:
    - Office app spawning scripts (Word/Excel → PowerShell/cmd/wscript)
    - Browser spawning unusual child processes
    - LOLBins (PowerShell, rundll32, mshta, regsvr32) used unexpectedly
5. Determine if this might be expected activity:
    - known IT tools (remote support, patching, software deployment)
    - approved admin scripts
    - legitimate installer behavior
6. Validate whether the alert could be a false positive:
    - PUA/adware classification
    - detection triggered by packed/unsigned but legitimate binaries
    - common dev tools or security tools flagged
7. Check for spread/impact indicators (quick):
    - other hosts with same hash/path in last 24–72 hours
    - multiple detections on the same host
    - recurring detection after remediation (persistence suspicion)
8. Check for high-risk signals (escalate faster if present):
    - remediation failed
    - persistence indicators (new service/task/autorun)
    - suspicious outbound connections (unknown domains/IPs)
    - credential access indicators (LSASS access, dump tools)
    - encryption / mass file changes (ransomware suspicion)
9. Document findings in the ticket using the template below.
10. Escalate with evidence summary and recommended containment if criteria are met.

## Quick “Hunt” Pseudo-Queries (light examples)
**Find other hosts with same hash (last 72 hours):**
```text
FROM EDR_EVENTS
WHERE file_hash == "<SHA256>"
  AND timestamp >= now() - 72h
SELECT timestamp, host, user, file_path, process_name, action_taken
ORDER BY timestamp DESC
```

## Find repeated detections on the same host (last 24 hours)
```text
FROM EDR_ALERTS
WHERE host == "<HOST>"
  AND timestamp >= now() - 24h
SELECT timestamp, alert_name, severity, file_path, process_name, remediation_status
ORDER BY timestamp DESC
```

## Common False Positives
- PUA/adware on non-critical endpoints where the policy is "detect and clean" (still document)
- Legitimate IT tools (remote support, patching, deployment agents) incorrectly flagged
- Developer tools or automation frameworks triggering "suspicious behavior" heuristics
- Packed installers or unsigned binaries from trusted vendors (verify source)

## Escalation Criteria
- Escalate if any of the following apply:
    - Remediation failed or an alert indicates that the active threat is still running.
    - Privileged/VIP endpoint or server asset
    - Evidence of persistence (task/service/autoruns) or repeat infection
    - Suspicious outbound connections to unknown/untrusted domains/IPs
    - Credential access indicators or lateral movement indicators
    - Ransomware suspicion (encryption, shadow copy deletion, mass file changes)
    - You cannot confidently classify the alert after initial validation. 

    (Reference: SOP "Escalation Criteria (Tier 1 --> Tier 2/Lead)") 

## Recommended Containment (Request via Tier 2/Lead per Policy)
- Isolate the host from the network (EDR network containment).
- Block the hash/domain/IP in security controls.
- Force malware remediation/full scan.
- Collect triage package (EDR forensic bundle), if available.
- Reset credentials if credential theft is suspected.

## Ticket Note Template (Copy/Paste)

- **Alert:**
- **Host/Device ID:** 
- **User:**
- **Time Range:**
- **Detection Type/Severity:**
- **File Path/Hash:**
- **Process/Parent/Command Line:**
- **EDR Action Taken:**
- **What I Checked:**
    - 
    - 
- **Findings (Facts):**
    - 
    - 
- **Assessment (TP/FP + confidence level)**:
- **Recommended Next Step/Containment:**
- **Escalation (if any):**

## Definition of Done
- **Ticket Includes:** core indicators (host/user/time/hash/path/process), EDR action status, checks performed, and disposition
- **If Escalated:** Tier 2 receives evidence summary and containment recommendation sufficient to act without rework.